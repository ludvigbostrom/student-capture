CREATE TABLE IF NOT EXISTS Users (
    UserId       SERIAL         PRIMARY KEY,
    FirstName    VARCHAR(64)    NOT NULL,
    LastName     VARCHAR(64)    NOT NULL,
    PersNr       CHAR(10)       NOT NULL,
    Pswd         TEXT           NOT NULL
    );

CREATE TABLE IF NOT EXISTS Course (
    CourseId    VARCHAR(10)    PRIMARY KEY,
    Year        INT            NOT NULL,
    Term        CHAR(4)        NOT NULL,
    CourseCode  CHAR(6)        NOT NULL,
    CourseName  TEXT
    );

CREATE TYPE IF NOT EXISTS role AS ENUM ('Teacher', 'Student', 'Assistant');
CREATE TABLE IF NOT EXISTS Participant (
    UserId       INT           references Users(UserId),
    CourseId     VARCHAR(10)   references Course(CourseId),
    Function     role          NOT NULL
    );

CREATE TABLE IF NOT EXISTS Assignment (
    AssignmentId      SERIAL         PRIMARY KEY,
    CourseId          VARCHAR(10)    references Course(CourseId) NOT NULL,
    Titl	      TEXT	     NOT NULL,
    StartDate         timestamp      NOT NULL,
    EndDate           timestamp      NOT NULL,
    MinTime           INT            NOT NULL,
    MaxTime           INT            NOT NULL,
    Published         boolean        NOT NULL
    );

CREATE TABLE IF NOT EXISTS Submission (
    AssignmentId	INT          references Assignment(AssignmentId) NOT NULL,
    StudentId           INT          references Users(UserId) NOT NULL,
    SubmissionDate      timestamp    NOT NULL,
    Grade               VARCHAR (3),
    TeacherId           INT          references Users(UserId),
    PRIMARY KEY (AssignmentId, StudentId)
    );

-- serial	4 bytes	autoincrementing integer	1 to 2147483647
-- bigserial	8 bytes	large autoincrementing integer	1 to 9223372036854775807

-- Insert and Update queries
INSERT 	INTO User (FirstName, Lastname, Personnummer)
		VALUES ("FirstName", "Lastname", "Personnummer");

INSERT 	INTO Course (Term, CourseCode, CourseName, Year)
		VALUES ("Term", "CourseCode", "CourseName", "Year");

INSERT 	INTO Participant (UserID, CourseID, Function)
		VALUES  ("UserID", "CourseID", "Function");

INSERT 	INTO Assignment (CourseID, StartDate, EndDate, Title, MinTime, MaxTime, Published)
		VALUES ("CourseID", "StartDate", "EndDate", "Title", "MinTime", "MaxTime", "Published");

INSERT 	INTO Submission (AssignmentID, StudentID, SubmissionDate)
		VALUES  ("AssignmentID", "StudentID", "SubmissionDate");

UPDATE 	Submission (Grade, TeacherID) = ("Grade", "TeacherID")
		WHERE AssignmentID = "AssignmentID" AND StudentID = "StudentID";
